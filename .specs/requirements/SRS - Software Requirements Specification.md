# 1.1 요구사항 정의서 (SRS - Software Requirements Specification) ⭐

> **ℹ️ 정보**
> - **Project Name**: Naver Financial & Dunamu Merge Project (NSC Platform)
> - **Version**: 1.1
> - **Last Updated**: 2026-01-30

---

## 1. 프로젝트 개요 (Introduction)

### 1.1 목적
본 프로젝트는 **네이버 파이낸셜의 커머스 결제망**과 **두나무(업비트)의 디지털 자산 기술**을 결합하여, **네이버 스테이블 코인(NSC)** 기반의 고성능 결제 및 정산 플랫폼을 구축하는 것을 목표로 한다.

### 1.2 핵심 목표
- **안정성**: 24/7 중단 없는 결제 처리 (Azure Cloud & Kafka 기반)
- **무결성**: 1원 단위의 오차도 없는 원장 관리 (Double Entry Bookkeeping)
- **확장성**: 대규모 트랜잭션 처리가 가능한 이벤트 기반 아키텍처 (EDA)

---

## 2. 기능 요구사항 (Functional Requirements)
> **범례**
> - **우선순위**: `P1`(필수/즉시구현), `P2`(중요/2차구현), `P3`(선택/나중에)
> - **기능구현**: `[x]` 구현 완료 / `[ ]` 미구현

### 2.1 지갑 및 자산 관리 (Wallet Management)

| ID | 요구사항 명 | 상세 설명 | 우선순위 | 기능 구현 |
| :--- | :--- | :--- | :---: | :---: |
| **FR-WAL-01** | 지갑 생성 | 사용자는 회원가입 시 고유한 NSC 지갑 주소를 부여받아야 한다. | P1 | [x] |
| **FR-WAL-02** | 잔액 조회 | 사용자는 현재 보유한 가용 NSC 잔액과 동결(Freeze)된 잔액을 구분하여 조회할 수 있어야 한다. | P1 | [x] |
| **FR-WAL-03** | 충전 (Minting) | 사용자는 KRW(원화)를 입금하여 1:1 비율로 NSC를 충전(발행)할 수 있어야 한다. | P1 | [x] |
| **FR-WAL-04** | 환전 (Burning) | 사용자는 보유한 NSC를 다시 KRW로 환전 요청할 수 있다. (수수료 로직 포함 가능) | P2 | [ ] |

### 2.2 결제 처리 (Payment Transaction)

| ID | 요구사항 명 | 상세 설명 | 우선순위 | 기능 구현 |
| :--- | :--- | :--- | :---: | :---: |
| **FR-PAY-01** | 결제 요청 (Freeze) | 사용자가 결제를 시도하면, 해당 금액만큼 지갑 잔액을 즉시 차감하지 않고 '동결(Hold)' 상태로 변경한다. | P1 | [x] |
| **FR-PAY-02** | 결제 확정 (Settle) | 커머스(쇼핑몰) 측에서 최종 승인 신호가 오면, 동결된 금액을 차감하고 판매자 지갑으로 이동시킨다. | P1 | [x] |
| **FR-PAY-03** | 결제 취소 (Rollback) | 결제 처리 중 오류가 발생하거나 사용자가 취소하면, 동결된 금액을 다시 가용 잔액으로 복구한다. | P1 | [x] |
| **FR-PAY-04** | 이중 지불 방지 | 동일한 주문 번호(Order ID)로 중복 요청이 들어올 경우, 1회만 처리하고 나머지는 거절해야 한다. (Idempotency) | P1 | [x] |
| **FR-PAY-05** | 비동기 결제 알림 | 결제 상태 변경(요청->완료) 시 Kafka 이벤트를 발행하여 외부 시스템(쇼핑몰)에 알려야 한다. | P2 | [ ] |

### 2.3 원장 및 관리자 (Ledger & Admin)

| ID | 요구사항 명 | 상세 설명 | 우선순위 | 기능 구현 |
| :--- | :--- | :--- | :---: | :---: |
| **FR-ADM-01** | 전체 원장 조회 | 관리자는 시스템 내의 모든 NSC 발행량과 사용자 잔액 총합이 일치하는지 확인할 수 있어야 한다. | P1 | [x] |
| **FR-ADM-02** | 거래 내역 추적 | 특정 트랜잭션 ID로 검색 시, 해당 거래의 시간, 보낸 사람, 받는 사람, 상태(성공/실패)를 조회해야 한다. | P2 | [ ] |
| **FR-ADM-03** | 일일 대사 (Reconciliation) | 매일 자정, 시스템상의 거래 로그 합계와 최종 잔액을 비교하여 불일치 건을 리포팅해야 한다. | P2 | [ ] |

### 2.4 데이터 분석 (Analytics - OLAP)

| ID | 요구사항 명 | 상세 설명 | 우선순위 | 기능 구현 |
| :--- | :--- | :--- | :---: | :---: |
| **FR-ANA-01** | 결제 패턴 수집 | 결제 데이터를 익명화하여 별도의 분석용 저장소(Data Lake)로 적재한다. | P3 | [ ] |
| **FR-ANA-02** | 실시간 시세 모니터링 | 외부 API(업비트 등)를 통해 관련 코인 시세를 수집하고 대시보드에 표출한다. | P3 | [ ] |

---

## 3. 비기능 요구사항 (Non-Functional Requirements)
> 시스템의 품질 속성 및 운영 제약사항을 정의합니다.

### 3.1 성능 (Performance)

| ID | 요구사항 명 | 상세 설명 |
| :--- | :--- | :--- |
| **NFR-PER-01** | 응답 속도 | 사용자 결제 요청(Freeze/Reserve)에 대한 API 응답은 **500ms 이내**여야 한다. (Network Latency 제외, 서버 처리 시간 기준) |
| **NFR-PER-02** | 처리량 (TPS) | 초당 **최소 100건**의 동시 결제 요청을 데이터 정합성 오류 없이 처리할 수 있어야 한다. |

### 3.2 안정성 및 보안 (Reliability & Security)

| ID | 요구사항 명 | 상세 설명 |
| :--- | :--- | :--- |
| **NFR-SEC-01** | 데이터 무결성 | 모든 금전 거래 데이터는 ACID 트랜잭션을 보장하는 **RDBMS(Azure SQL/PostgreSQL)**에 저장하여 원자성을 유지해야 한다. |
| **NFR-SEC-02** | 통신 보안 | 모든 내/외부 API 통신은 **HTTPS (TLS 1.2 이상)** 프로토콜을 사용하여 암호화되어야 한다. |
| **NFR-REL-01** | 장애 격리 및 복구 | 결제 서버(Consumer)가 다운되더라도, Kafka에 인입된 주문 요청 메시지는 유실되지 않아야 하며 서버 복구 시 즉시 처리되어야 한다. |

### 3.3 운영 환경 (Environment)

| ID | 요구사항 명 | 상세 설명 |
| :--- | :--- | :--- |
| **NFR-ENV-01** | 클라우드 인프라 | 모든 서비스 리소스(Compute, Database, Network)는 **Microsoft Azure** 환경을 기반으로 구축되어야 한다. |
| **NFR-ENV-02** | 컨테이너화 | 모든 애플리케이션은 **Docker** 이미지로 빌드되어야 하며, 이를 통해 일관된 배포 및 스케일링이 가능해야 한다. |

---

## 4. 데이터 요구사항 (Data Requirements)
> 시스템에서 관리해야 할 핵심 엔티티 및 속성을 정의합니다.

### 4.1 핵심 엔티티 (Key Entities)

- **UserWallet (사용자 지갑)**
    - **설명**: 사용자의 자산을 관리하는 테이블
    - **주요 속성**:
        - `user_id` (PK): 사용자 고유 식별자
        - `balance_available`: 사용 가능한 잔액
        - `balance_frozen`: 결제 진행 중(Freeze) 묶여있는 잔액
        - `wallet_address`: 지갑 주소 (필요 시 블록체인 연동용)

- **TransactionLedger (거래 원장)**
    - **설명**: 모든 자산 흐름을 기록하는 불변의 로그 테이블
    - **주요 속성**:
        - `tx_id` (PK): 트랜잭션 고유 ID (UUID 권장)
        - `order_id`: 연관된 주문 번호 (FK)
        - `sender`: 보내는 사람 (User ID)
        - `receiver`: 받는 사람 (Merchant ID or User ID)
        - `amount`: 거래 금액
        - `status`: 상태 값 (PENDING, COMPLETED, FAILED)
        - `type`: 거래 유형 (PAYMENT, CHARGE, REFUND)
        - `timestamp`: 거래 생성 시간

---

## 5. 인터페이스 요구사항 (Interface Requirements)
> 내부 서비스 간 통신 및 외부 시스템과의 연동 방식을 정의합니다.

### 5.1 내부 시스템 연동 (Internal Integration)

- **Protocol**: 
    - **Synchronous (동기)**: 클라이언트 요청 및 즉각적인 응답이 필요한 조회/요청은 **REST API** 사용.
    - **Asynchronous (비동기)**: 결제 처리, 알림 발송, 원장 기록 등 후속 처리는 **Kafka Message**를 통해 이벤트 기반으로 처리.
- **Data Format**: 모든 페이로드는 **JSON** 형식을 표준으로 사용.

### 5.2 외부 시스템 연동 (External Integration)

- **대상**: 외부 시세 제공 업체 (예: 업비트, 바이낸스 등) 또는 PG사
- **Method**:
    - **실시간성이 중요한 경우**: WebSocket 연결 유지.
    - **주기적 확인이 필요한 경우**: REST API Polling 방식 사용.
- **Fault Tolerance (장애 허용)**:
    - **Timeout**: 외부 시스템 응답이 3초 이상 지연될 경우 Timeout 예외를 발생시킨다.
    - **Circuit Breaker**: 연속적인 실패 감지 시 Circuit Breaker를 개방(Open)하여 시스템 전체의 지연을 방지하고 빠른 실패(Fail Fast)를 유도한다.

---

> **용어설명**
> - **원장(元帳, Ledger)**: 기업이나 사업에서 발생하는 모든 거래 내역(돈의 흐름, 자산의 증감 등)을 계정과목별로 정리하여 기록한 최종적인 회계 장부를 말함.