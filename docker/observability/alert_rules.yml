groups:
  - name: backoffice-slo
    rules:
      - alert: ApiLatencyP95High
        expr: histogram_quantile(0.95, sum(rate(api_request_latency_seconds_bucket[5m])) by (le)) > 0.2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API p95 latency above 200ms"
          description: "API p95 latency has exceeded 200ms for more than 5 minutes."

      - alert: ApiErrorRateHigh
        expr: sum(rate(api_requests_total{status_code=~\"4..|5..\"}[5m])) / sum(rate(api_requests_total[5m])) > 0.02
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API error rate above 2%"
          description: "API error rate (4xx/5xx) has exceeded 2% for more than 5 minutes."

      - alert: DataFreshnessHigh
        expr: max(consumer_freshness_seconds) by (topic) > 5
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Data freshness above 5s"
          description: "Backoffice data freshness has exceeded 5 seconds for more than 5 minutes."

      - alert: ConsumerDlqRateHigh
        expr: sum(rate(consumer_dlq_total[5m])) > 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "DLQ activity detected"
          description: "Consumer is writing to DLQ. Investigate errors in the sync pipeline."
